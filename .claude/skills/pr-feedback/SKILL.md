---
name: pr-feedback
description: Address reviewer feedback on GitHub pull requests by making targeted fixes or explaining disagreements. Use when responding to PR comments.
---

# PR Feedback Handler

Address reviewer feedback on GitHub pull requests by making targeted fixes or explaining disagreements.

## Instructions

When this skill is invoked, follow these steps:

### Step 1: Get PR Number

If no PR number is provided, get the current branch's PR:

```bash
gh pr view --json number -q '.number'
```

### Step 2: Retrieve All Review Comments

Fetch all review comments (both human and AI reviewers):

```bash
# Get PR review comments (inline code comments)
gh api repos/{owner}/{repo}/pulls/{pr_number}/comments --jq '.[] | {id, user: .user.login, body, path, line: .original_line, commit_id: .original_commit_id, in_reply_to_id, url: .html_url}'

# Get PR review threads with their resolution status
gh api repos/{owner}/{repo}/pulls/{pr_number}/reviews --jq '.[] | {id, user: .user.login, state, body}'

# Get issue-style comments on the PR
gh api repos/{owner}/{repo}/issues/{pr_number}/comments --jq '.[] | {id, user: .user.login, body, url: .html_url}'
```

### Step 3: Process Each Comment

For each unresolved comment thread:

#### 3a. Analyze the Feedback

Read the comment and determine:
- Is this actionable feedback about the code?
- Is the concern valid and relevant?
- Does it identify a real bug, style issue, or improvement?

Skip comments that are:
- Already resolved
- General discussion/questions (not actionable)
- Approval messages or acknowledgments

#### 3b. If You Agree with the Feedback

1. **Make a surgical fix** - Change only what's needed to address the specific feedback
2. **Commit the change** with a clear message:
   ```bash
   git add <specific-file>
   git commit -m "$(cat <<'EOF'
   Fix: <brief description of what was fixed>

   Addresses review feedback: <short summary>

   Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
   EOF
   )"
   ```
3. **Get the commit SHA**:
   ```bash
   git rev-parse HEAD
   ```
4. **Reply to the comment** with a link to the commit:
   ```bash
   gh api repos/{owner}/{repo}/pulls/{pr_number}/comments/{comment_id}/replies \
     -f body="Fixed in [\`{short_sha}\`](https://github.com/{owner}/{repo}/commit/{full_sha})

*Comment generated by Claude Code*"
   ```

#### 3c. If You Disagree with the Feedback

Reply to the comment thread explaining why (2-3 sentences max):

```bash
gh api repos/{owner}/{repo}/pulls/{pr_number}/comments/{comment_id}/replies \
  -f body="@{reviewer_username} <explanation of why you disagree - 2-3 sentences max>

*Comment generated by Claude Code*"
```

**Note:** If the comment is from `chatgpt-codex-connector[bot]` (Codex), always tag `@codex` instead of the bot username to invite their response.

Common reasons to disagree:
- The suggested change would break existing functionality
- The current approach is intentional for a specific reason
- The feedback is based on a misunderstanding of the code's purpose
- The suggestion conflicts with project conventions

### Step 4: Push All Commits

After addressing all feedback:

```bash
git push
```

### Step 5: Report Summary

Provide a summary of actions taken:
- Number of comments addressed with fixes
- Number of comments where you disagreed (with brief reasons)
- Number of comments skipped (already resolved, not actionable)

## API Reference

### Reply to a review comment
```bash
gh api repos/{owner}/{repo}/pulls/{pr_number}/comments/{comment_id}/replies \
  -f body="Your response

*Comment generated by Claude Code*"
```

### Reply to an issue comment
```bash
gh api repos/{owner}/{repo}/issues/{pr_number}/comments \
  -f body="Your response

*Comment generated by Claude Code*"
```

### Get repo owner and name
```bash
gh repo view --json owner,name -q '"\(.owner.login)/\(.name)"'
```

## Example Workflow

```
Comment: "This function should handle the case where the list is empty"
Analysis: Valid - the function doesn't check for empty input
Action: Add empty list check, commit, reply with commit link

Comment: "Consider using a more descriptive variable name than 'x'"
Analysis: Disagree - 'x' is conventional for coordinates in this context
Action: Reply "@reviewer x is the standard name for x-coordinates in graphics code, keeping for consistency with the domain"

Comment: "Nice work!"
Analysis: Not actionable - skip
Action: None
```

## Notes

- **Always append `*Comment generated by Claude Code*` to all PR comment replies**
- **When disagreeing with Codex (`chatgpt-codex-connector[bot]`), tag `@codex` to invite their response**
- Always run tests after making changes: `pytest tests/ -v`
- Keep commits atomic - one fix per commit
- Don't refactor beyond what the feedback asks for
- If a fix requires multiple file changes, that's okay - commit them together
- Tag the reviewer in disagreement responses so they get notified
